<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Is Slippi Ranked Free Today?</title>
		<link rel="icon" href="data:,"> 
		<!-- aim for under 14kb page and one single network request for peak performance -->
		<!-- inline favicon and styles and scripts, and use system fonts -->

		<style>
			/* @link https://utopia.fyi/type/calculator?c=320,18,1.2,1240,20,1.25,10,5,&s=0.75|0.5|0.25,1.5|2|3|4|6,9|3xs-s&g=s,l,xl,12 */
			
			/* @link https://utopia.fyi/space/calculator?c=320,18,1.2,1240,20,1.25,10,5,&s=0.75|0.5|0.25,1.5|2|3|4|6,9|3xs-s&g=s,l,xl,12 */

			/* 5rem, 3.75rem, 2.5rem, 1.875rem, 1.25rem, 0.9375rem
			*/

		* {
			font-family: system-ui;
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			min-height: 100vh;
			min-height: 100svh;
			display: grid;
			place-items: center;
		}

		main {
			height: 100%;
			display: flex;
			flex-direction: column;
			/* justify-content: space-between; */
			align-items: center;
			padding-inline-start: 5rem;
			padding-inline-end: 5rem;
		}

		main:last-child {
			flex-grow: 1;
		}

		footer {
			position: absolute;
			bottom: 0;
			left: 0;
			margin: 1em;
		}

		h1 {
			font-size: 11.6415rem;
			margin-block-start: 7.5rem;
			margin-block-end: 7.5rem;
		}

		#timer {
			font-size: 3.0518rem;
			letter-spacing: -0.025rem;
			line-height: 1.25em;
		}

		.tiny {
			font-size: 0.8rem;
		}

		p {
			font-size: 1.25rem;
			text-align: center;
		}

		#extra {
			display: none;
		}
		</style>

	</head>

	<body>
		<noscript>
			Slippi Ranked is free every fourth day after April 15, 2024.
			To see if Slippi Ranked is free today, enable JavaScript.
		</noscript>
		<main>
			<h1></h1>
			<p id="timer"></p>
			<!-- <p id="placeholder"></p> -->
		</main>
		<footer class="tiny">
			see <a href="https://slippi.gg">slippi.gg</a>
			<br>
			<span id="extra">and perhaps a mental health hotline: 1-800-273-TALK</span>
			also <a href="https://wonger.dev">me</a>
		</footer>
	</body>

	<script>
		let h1 = document.querySelector('h1')
		let timer = document.querySelector('#timer')
		let extra = document.querySelector('#extra')
		// let placeholder = document.querySelector('#placeholder')

		// https://github.com/project-slippi/slippi-launcher/pull/434/files#diff-44b494a9d47f2927c5fc59ecbf1419262f55cd74bf503c9b2c3767a2fbf985bcR15-R70

		// all timestamps are UNIX-style, milliseconds since epoch, UTC
		const FREE_ACCESS_START_MS = Date.UTC(2024, 3, 15, 8, 0, 0)
		const MS_PER_DAY = 24 * 60 * 60 * 1000
		const MS_BETWEEN_RANKED_DAYS = 4 * MS_PER_DAY

		let isItRanked = (now) => {
			// now : int, millis since epoch in UTC
			// returns : { isHappening : bool, msRemaining : int, millis since epoch in UTC }
			//
			// isHappening === true
			//                             
			//     prevStart [---now---|prevEnd --------------------] nextStart
			//                        
			//
			//
			// isHappening === false
      //
			//     prevStart [---------|prevEnd ---------now--------] nextStart
			//
			let daysSinceFirstStart = Math.floor( (now - FREE_ACCESS_START_MS) / MS_PER_DAY )
			let daysUntilNextStart = ( 4 - (daysSinceFirstStart % 4) )
			let nextStart = FREE_ACCESS_START_MS + (daysSinceFirstStart + daysUntilNextStart) * MS_PER_DAY
			let prevStart = nextStart - MS_BETWEEN_RANKED_DAYS
			let prevEnd = prevStart + MS_PER_DAY

			let isHappening = prevEnd > now
			let msRemaining = (isHappening ? prevEnd - now : nextStart - now )

			return {isHappening, msRemaining}
		}

		let formatDuration = (millis) => {
			// millis : int
			// returns : string

			// is locale-dependent formatting needed here?

			let msLeftover = millis % 1000
			let secs = (millis - msLeftover) / 1000
			let secsLeftover = secs % 60
			let mins = (secs - secsLeftover) / 60
			let minsLeftover = mins % 60
			let hrs = (mins - minsLeftover) / 60
			let hrsLeftover = hrs % 24
			let days = (hrs - hrsLeftover) / 24

			if (days === 0 && hrsLeftover === 0 && minsLeftover === 0) {
				return 'seconds'
			}
			else if (days === 0 && hrsLeftover === 0) {
				return `${pluralize(mins, 'minute')}`
			}
			else if (days === 0) {
				return `${pluralize(hrsLeftover, 'hour')} and ${pluralize(minsLeftover, 'minute')}`
			}
			else {
				return `${pluralize(days, 'day')}, ${pluralize(hrsLeftover, 'hour')}, and ${pluralize(minsLeftover, 'minute')}`
			}
		}

		let pluralize = (quantity, noun) => {
			// assuming simple case of english suffix 's'
			// quantity : int
			// noun : string
			// returns : string
			return (quantity == 1 ? `1 ${noun}` : `${quantity} ${noun}s`)
		}

		let update = () => {
			// contains side-effects to update display

			let now = Date.now() // Date.UTC(2024, 3, 20, 9, 1, 0) //
			let {isHappening, msRemaining} = isItRanked(now)

			if (isHappening) {
				document.title = h1.textContent = 'YES'
				timer.textContent = `you have ${formatDuration(msRemaining)} left to grind!`
				extra.style.display = 'block'
			}
			else {
				document.title = h1.textContent = 'NO'
				timer.textContent = `you gotta wait ${formatDuration(msRemaining)}`
				extra.style.display = 'none'
			}

			// placeholder.style.display = 'none'
		}

		// placeholder.textContent = 'thinking...'
		window.setInterval(update, 1000)


		// https://emojikitchen.dev/ -> maybe frog variants?
	</script>

</html>

